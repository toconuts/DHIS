<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>MAP Surveillance - Dominica Health Information System</title>
    <link rel="shortcut icon" href="{{ asset('favicon.ico') }}" />
{#    {% stylesheets '@DHISCommonBundle/Resources/public/css/main.css'
                 '@DHISSComDisBundle/Resources/public/css/content.css' %}
    <link href="{{ asset_url }}" type="text/css" rel="stylesheet" /> #}
    <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
    <script type="text/javascript" src="{{ asset('bundles/dhisscomdis/js/latlng_district.js') }}"></script>
    <script type="text/javascript" src="{{ asset('bundles/dhisscomdis/js/latlng_clinics.js') }}"></script>
    <script>


 // Create an object containing id of LatLng, grade, and coefficient.
var districts = {};
districts['Marigot'] = {
  id: 1,
  phase: 1,
  coefficient: '0.000'
}
districts['Grand Bay'] = {
  id: 2,
  phase: 2,
  coefficient: '1.000'
}
districts['St Joseph'] = {
  id: 3,
  phase: 3,
  coefficient: '2.200'
}
districts['La Plaine'] = {
  id: 4,
  phase: 4,
  coefficient: '3.300'
}
districts['Castle Bruce'] = {
  id: 5,
  phase: 5,
  coefficient: '4.400'
}
districts['Portsmouth'] = {
  id: 6,
  phase: 1,
  coefficient: '0.011'
}
districts['Roseau'] = {
  id: 7,
  phase: 1,
  coefficient: '0.011'
}

var clinics = {};
clinics['MARIGOT'] = {
  id: 1001,
  phase: 1,
  coefficient: '0.011'
}
clinics['PETITE SAVANNE'] = {
  id: 2002,
  phase: 2,
  coefficient: '1.000'
}
clinics['COULIBSTRIE'] = {
  id: 3003,
  phase: 3,
  coefficient: '2.000'
}
clinics['BOETICA'] = {
  id: 4004,
  phase: 4,
  coefficient: '3.000'
}
clinics['GAULETTE RIVER'] = {
  id: 5005,
  phase: 5,
  coefficient: '4.000'
}
clinics['VIELLE CASE'] = {
  id: 6006,
  phase: 1,
  coefficient: '5.000'
}
clinics['ROSEAU'] = {
  id: 7101,
  phase: 1,
  coefficient: '0.111'
}
clinics['FONDCOLE'] = {
  id: 7202,
  phase: 2,
  coefficient: '1.222'
}
clinics['SOUFRIERE'] = {
  id: 7303,
  phase: 3,
  coefficient: '2.333'
}
clinics['MORNE PROSPER'] = {
  id: 7404,
  phase: 4,
  coefficient: '3.444'
}
clinics['ROSS UNIVERSITY'] = {
  id: 9001,
  phase: 5,
  coefficient: '4.555'
}

//var gradeColor = [ '#88FF88', '#00FF00', '#00FFFF', '#0000FF', '#FF00FF' ];
//var gradeColor = [ '#FFFF66', '#FF9900', '#FFCCCC', '#FF9999', '#CC0000' ];
//var gradeColor = [ '#FFFFFF', '#FFFF66', '#FF9900', '#FF9999', '#CC0000' ];
//var gradeColor = [ '#FFFFFF', '#FFFF66', 'yellow', '#FF9900', '#CC0000' ];
var gradeColor = [ '#FFFFFF', 'yellow', '#FF9900', '#FF9999', '#CC0000' ];
//var gradeColor = [ '#FFFFFF', '#FFFF66', 'yellow', '#FF9999', '#CC0000' ];
//var gradeColor = [ '#FFFF66', 'yellow', '#FF9900', '#FF9999', '#CC0000' ];
      function initialize() {
        var mapDiv = document.getElementById('map-canvas');
        var map = new google.maps.Map(mapDiv, {
          center: new google.maps.LatLng(15.422687, -61.34634),
          zoom: 11,
          mapTypeId: google.maps.MapTypeId.ROADMAP
        });
  
        for (var district in districts) {
          // Construct the shape for each value in district.
          var shape = new google.maps.Polygon({
            paths: getDistrictLatLng(districts[district].id),
            strokeColor: gradeColor[districts[district].phase - 1],
            strokeOpacity: 0.8,
            strokeWeight: 2,
            fillColor: gradeColor[districts[district].phase - 1],
            fillOpacity: 0.35
          });
          shape.setMap(map);
          var contentString = createContentString(district, 'District', districts[district].coefficient, districts[district].phase);
          attachInfoWindow(shape, contentString);
        }
        
        for (var clinic in clinics) {          
          // Construct the circle for each value in clinics. We scale phase by 500.
          var circle = new google.maps.Circle({
            //strokeColor: '#FF0000',
            strokeColor: 'green',
            strokeOpacity: 0.8,
            strokeWeight: 2,
            //fillColor: '#FF0000',
            fillColor: 'blue',
            fillOpacity: 0.35,
            map: map,
            center: getClinicLatLng(clinics[clinic].id),
            radius: clinics[clinic].phase * 500
          });
          
          var contentString = createContentString(clinic, 'Clinic', clinics[clinic].coefficient, clinics[clinic].phase);
          attachInfoWindow(circle, contentString);
        }
      }
      
      function attachInfoWindow(marker, contentString) {
        var infowindow = new google.maps.InfoWindow({
          content: '<div>' + contentString + '<div>',
          maxWidth: 200
        });

        google.maps.event.addListener(marker, 'mouseover', function(ev) {
          infowindow.setPosition(ev.latLng);
          infowindow.open(marker.get('map'));
        });
        
        google.maps.event.addListener(marker, 'mouseout', function(ev) {
          infowindow.close();
        });
      }
      
      function createContentString(siteName, siteType, coefficient, phase)
      {
        return '<div id="infowindow"><h3>' + siteName + '</h3>' +
               '<p>Type: ' + siteType + '<br>' + 
               'Coefficient: ' + coefficient + '<br>' + 
               'Phase: ' + phase + '</p></div>';
      }

      google.maps.event.addDomListener(window, 'load', initialize);
    </script>
  </head>
  <body style="font-family: Arial;border: 0 none;">
    {% if app.request.session.hasFlash('success') %}
    <div class="alert alert-success">
      {{ app.request.session.getFlash('success') }}
    </div>
    {% endif %}
    {% if app.request.session.hasFlash('error') %}
    <div class="alert alert-error">
    {{ app.request.session.getFlash('error') }}
    </div>
    {% endif %}
    
    <div>Hello</div>
    <hr>
    <div id="map-canvas" style="width: 720px; height: 720px"></div>
    <footer>
        <hr>
        <p>&copy; HIU.MOH 2013</p>
    </footer>
  </body>
</html>
